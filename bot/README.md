# 电报多管理员客服机器人

一个功能完整的电报客服机器人，支持多管理员配置、消息路由、会话管理等功能。

## ✨ 核心功能

### 用户端
- 🎯 **管理员选择界面**：3列网格布局的按钮选择
- 📱 **智能消息路由**：自动转发消息至对应管理员
- 🔒 **信息保护**：电话号码自动脱敏处理
- ⏰ **会话管理**：30分钟无互动自动关闭

### 管理员端
- 🔔 **实时通知**：新用户咨询即时提醒
- 💬 **一键回复**：内置回复按钮，操作便捷
- 📊 **用户信息**：显示用户ID、用户名等详细信息
- 🔄 **双向绑定**：回复消息自动关联原始用户

## 🚀 快速部署

### 1. 环境准备
```bash
# 确保Python 3.7+
python3 --version

# 安装依赖
pip install -r requirements.txt
```

### 2. 获取机器人Token
1. 在电报中搜索 `@BotFather`
2. 发送 `/newbot` 创建新机器人
3. 设置机器人名称和用户名
4. 复制获得的Token

### 3. 配置管理员
1. 在电报中搜索 `@userinfobot`
2. 发送任意消息获取您的用户ID
3. 编辑 `config.ini` 文件：
   ```ini
   [BOT]
   token = 你的机器人Token
   
   [ADMINS]
   技术支持 = 你的用户ID
   财务咨询 = 另一个管理员ID
   ```

### 4. 启动机器人
```bash
python3 bot.py
```

## 📁 文件结构

```
/bot
├── bot.py          # 主程序文件
├── config.ini      # 配置文件
├── requirements.txt # 依赖列表
├── database.db     # SQLite数据库（自动生成）
└── README.md       # 本文件
```

## 🔧 配置说明

### 机器人配置
- `token`: 从BotFather获取的机器人Token
- `session_timeout`: 会话超时时间（分钟）
- `check_interval`: 检查超时的时间间隔（秒）

### 管理员配置
```ini
[ADMINS]
显示名称 = 用户ID
```

**注意**：用户ID必须是数字，可以通过 `@userinfobot` 获取。

## 💡 使用流程

### 用户咨询流程
1. 用户发送 `/start`
2. 机器人显示管理员选择界面
3. 用户选择管理员
4. 用户发送咨询内容
5. 机器人转发给对应管理员

### 管理员回复流程
1. 管理员收到用户咨询通知
2. 点击"回复用户"按钮或直接回复消息
3. 机器人自动转发回复给用户
4. 用户收到标记为"客服回复"的消息

## 🛡️ 安全特性

- **身份验证**：仅配置文件中管理员可回复
- **信息脱敏**：电话号码自动隐藏中间4位
- **会话隔离**：不同用户会话完全独立
- **超时保护**：自动关闭长时间无互动会话

## 🔍 故障排除

### 常见问题

**Q: 机器人无法启动**
A: 检查 `config.ini` 中的Token是否正确，确保网络连接正常

**Q: 管理员收不到通知**
A: 确认管理员ID正确，且机器人已被管理员启动过

**Q: 消息无法转发**
A: 检查用户是否已选择管理员，会话是否仍然活跃

### 日志查看
机器人运行时会输出详细日志，包括：
- 启动状态
- 消息处理
- 错误信息
- 会话管理

## 📈 扩展功能

### 可添加的功能
- 消息统计和报表
- 多语言支持
- 文件传输支持
- 自动回复模板
- 工作时间和状态管理

### 自定义开发
机器人采用模块化设计，可以轻松添加新功能：
1. 在 `CustomerServiceBot` 类中添加新方法
2. 在 `run()` 方法中注册新的处理器
3. 根据需要扩展数据库结构

## 📞 技术支持

如遇到问题，请检查：
1. Python版本是否兼容（3.7+）
2. 依赖包是否正确安装
3. 配置文件格式是否正确
4. 网络连接是否正常

## 📄 许可证

本项目采用MIT许可证，可自由使用和修改。

---

**祝您使用愉快！** 🎉